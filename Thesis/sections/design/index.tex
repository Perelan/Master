
\chapter{Analysis and High-Level Design}

It is the goal of this thesis to enable detection of sleep-related illnesses 
with the aid of an Android device and low-cost sensors, and to further analyze 
and evaluate sleep- and breath-related patterns. We developed an application, 
called \textit{Nidra}, which attempts to collect, analyze and share data collected 
from external sensors, all on a mobile device. Also, Nidra acts as a platform for 
modules to enrich the data, thus extending the functionality of the application.

The motivation behind this application is to provide an interface for patients 
to potentially run a self-diagnostic from home, and to aid 
researchers and doctors with analysis of sleep- and breathing-related illnesses 
(e.g., Obstructive Sleep Apnea). An overview of the Nidra application pipeline 
can be found in Figure x, beginning with data acquired from a sensor, and ending 
with the data in the Nidra application. As for now, Nidra consists of three 
main functionalities, each related to the requirements defined in Section [Problem Statement]. 

\begin{enumerate}
    \item The application should provide an interface for the patient to 1) record physiological signals (e.g., during sleep); 2) present the results; and 3) share the results.
    \item The application should provide an interface for the developers to create modules to enrich the data from records or extend the functionality of the application. 
    \item The application should ensure a seamless and continuous data stream, uninterrupted from sensor disconnections and human disruptions.
\end{enumerate}

This chapter will give a detailed look at the design of Nidra, including the tasks which constitute the structure of the application, the seperate concerns in relation to the tasks, and the structure of the data in the application.

\section{Requirement Analysis}

\input{sections/design/stakeholders}

%\input{sections/design/sysreq.tex}

\subsection{Resource Efficiency}
The application is designed for the use on a mobile device; modern mobile devices are empowered with multi-core processors, a sufficient amount of ROM, and a variety of sensors. However, the battery capacity is restrictive and based on usage. The device may only last for one day before a charge, due to the size of the battery capacity \cite{androidbattery}. The average battery capacity of a mobile device is approximately 2000 mAh on budget devices and around 3000 mAh on high-end devices \cite{androidbatteryavg}. The application should be able to run at least 7 hours without any power supply. Also, the device should be capable of handling various sensor connections simultaneously. Therefore, the application should be designed to be resource efficient, by utilizing least amount of battery resources during a recording. Also, ensure sufficent amount of power on the device before starting a recording session.  

\subsection{Security and Privacy}
The proposed use of the application is to monitor the sleeping patterns of a patient. The application manages and stores personal- and health-related data about the patient. As a consequence, the application should incorporate the CIA triad, which stresses data confidentiality, integrity, and availability \cite{cia}. Any unauthorized access to the data, data leaks, and confidentiality should be appropriately managed on the device. Sharing the data across application or with researchers/doctors should be granted with the consent from the patient.  Besides, a mobile device can be connected to the Internet, which makes it vulnerable to attacks. Also, other installed application on the device can manipulate the access to the data. Therefore, revising the security policy defined by Android \cite{androidsecurity} should be incentivized. 

\section{High-Level Design}

\subsection{Task Analysis}
Task analysis is a methodology to facilitate the design of complex systems. Hierarchical task analysis (HTA) is an underlying technique that analyzes and decomposes complex tasks such as planning, diagnosis, and decision making into specific subtasks \cite{ta}. In Figure \ref{fig:hta_overview}, an illustration of the the tasks of the application is presented. This Subsection will introduce these tasks, which are an integral part to the development of the application.

\begin{figure}
    \centering
    \includegraphics[scale=0.23]{images/TA.png}
    \caption{Recording}
    \label{fig:hta_overview}
\end{figure}

\input{sections/design/systemtasks}

\section{Seperation of Concerns}
Separation of concern is a paradigm that classifies an application into concerns at a conceptual and implementational level. It is beneficial for reducing complexity, improving understandability, and increasing reusability \cite{soc}. The concerns in this thesis are the individual tasks defined in task analysis. Each concern is conceptualized with a graph of components, the functionality of each component when combined constitutes a structure. The structure of each concern is derived based on research and development. In this Section, we will analyze and decompose the tasks defined in task analysis into subtasks (hereafter: components), where each component is functionality   

\input{sections/design/soc}

\section{Data Structure}

\input{sections/design/dataformat}