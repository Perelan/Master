\chapter{Conclusion}

\section{Summary}
Our motivation for this thesis was to extend the CESAR project by creating an application for patients to be able to record, share, and analyze breathing data from home. The data is supposed to aid researchers/doctors in analysis, diagnosis, or examination of the patient for sleep-related breathing disorders (e.g., obstructive sleep apnea). However, the application can be applied to other fields of study, such as recording breathing during physical activity. Moreover, the application should facilitate an interface for developers to create modules which extend the functionality or enrich the data of the application.

To achieve this, we designed an application by separating the tasks\footnote{recording, sharing, analyzing, modules, storage, and presentation} into concerns, for each of which a structure consisting of components with several functionalities and design choices was proposed. Based on the design, we implemented an application in Android, called Nidra. We created a user-friendly interface for the users to record breathing data over an extended period (e.g., overnight) by creating a sensor wrapper that the support for collecting breathing data from the Flow sensor over the BlueTooth LE protocol with the data streams dispatching tool. The Flow sensor was prone to disconnecting; thus, we incorporated a mechanism which reconnects with the Flow sensor upon disconnects. As a result, the data is richer and more meaningful upon analysis. Further, we added the support for sharing the records---containing the samples gathered over the period of recording---across applications, allowing the patients to share their records with the researchers/doctors over a media (e.g., e-mail). Finally, we integrated a simple form for analysis of the data within the application; in other words, a time-series graph with the breathing value and time of acquisition. However, we also created an interface for developers to create modules which allow for extended functionality and data enrichment. For example, a module can use the data from patient records in order to predict sleep apnea with the use of machine-learning techniques.

To evaluate the application, we performed various experiments ranging from recording in a crowded environment and over an extended period while measuring the battery consumption, to evaluating the user-friendliness of the application and the process of creating a new module. Based on the results, we see that the application is capable of collecting breathing data from various mobile devices---running different Android OS version---using the Flow sensor. Also, our application is capable of reconnecting with the Flow sensor upon disconnects; from the experiment, the worst-case of data loss was no more than 40\%. Moreover, we tested the battery consumption of the application. Keeping in consideration that there are three other applications, including our application, running in the background while collecting data over BlueTooth LE protocol, the results show that for over 8-hours of recording the process of recording use 1240 mAh of the battery capacity. That is reasonable in consideration of the average battery capacity of a low-end mobile device. Next, we evaluated the user-friendliness of the application on the functionality of recording, sharing, and analyzing. While overall, our application is user-friendly and easy-to-use, the recording screen seems to lack information to guide new users in the process; however, that can easily be adjusted. Finally, we allowed a developer to create a module that uses the data from our application in order to find the record with the highest sample count. As a result, the module worked as intended, and it successfully extended the functionality of Nidra. 


\section{Contributions}
 As defined in our problem statement, we set three research goals with three system requirements. The following sections reinstate and describe how this thesis contributes to them.

\begin{description}
    \item[Goal 1] \textit{Integrate the support for Flow sensor with the extensible data streams dispatching tool.}

    This goal is supported by the development of the Flow sensor wrapper, which integrates with the data streams dispatching tool. The Flow sensor uses BlueTooth LE as a communication protocol. As such, we used the APIs provided by Android to connect with the sensor, and focused on extracting the flow (breathing) data and battery level, as well as the MAC address and firmware level. By creating a sensor wrapper for the Flow sensor and integrating with the data streams dispatching tool, we extend the tool for integration of the FLow sensor. That allows future developers to operate with the Flow sensor in their analysis.


    \item[Goal 2] \textit{Research and develop a user-friendly application which facilitates collection of breathing data with the use of the extensible data streams dispatching tool.}

    This goal is supported by the development of the Nidra, which provides an interface for recording, sharing, analyzing breathing data collected with the Flow sensor using the data streams dispatching tool on a mobile device. With this application, we allow patients to record their breathing data over an extended period, and to analyze the data within the application. Also, we allow the patients to send their record---e.g., over e-mail---to their researchers/doctors for further analysis. As such, we provide an interface to the patients to monitor their breathing from home, aiding the reducing the stress and work enduced on the patients, as well as the labratories. 
    
    unctionality of sharing, the user can share the records with researchers/doctors. That allows for further 

    \item[Goal 3] \textit{Create an extensible solution such that the developers can integrate stand-alone applications in our application.}

    This goal is supported by the integration of modules in the Nidra application. We allow future developers to create and integrate their applications functionality into Nidra, without having to understand how Nidra operate, and leverge the data Nidra provides. This allowsfuture developers to enrich the data or extend the functionality by using the data provided by Nidra, and for patients to operate with one application for detection for sleep apnea. 
\end{description}


\section{Future Work}
Over the course of this thesis, we were able observe enhancements and improvements that can be made to the application. While the application fulfilles the goals defined in the problem statement, there are possibilities to make the experience of the application even richer. Below, we present the a short description of future work alongside with our proposition. 


\begin{description}
    \item[Improve the user-friendliness of Nidra:] In retrospect, we could see that the participants had trouble with finding the record button, as well as the indication of whether a recording had started. A proposition is to enlargen til record button, to make it more visible to the users. For the recording, perhaps have a more informative description of the various states (e.g., connecting, recording, or disconnected). 
    \item[Add support for other physiological data] The main focus in this thesis, was to gather breathing data during sleep. However, the possibility of extending Nidra to support other physiological data is possible (e.g., heart rate). The extensible approach to application, allows future developers to integrate the support for these data types, by simply extending the database and recording logic. 
    \item[Create an interface for sharing] A proposition in the design for sharing, was to create an interface solely for sharing data between users, without accessing other applications (e.g., mail). The idea was to create a server that maintains a user-base of patients and researchers/doctors, and a repository for shared records. By providing an interface for the patient to select the desired recipient, would allow for a simpler and convenient sharing for both the patient and the research/doctor. 
    \item[Bi-directional channel between Nidra and modules] As of now, the data is packed into a JSON string and bundled into an Intent on launch. As discussed in the design, this would mean that for the module to obtain the data the user has to launch the module through the application. For simplicity, this is sufficient; however, for future modules that depends on analyzing the data in real-time, that is not a suitable solution. Therefore, by establishing a bi-directional channel with Nidra and the modules is a solution to this problem. By utilizing binder's (with AIDL) for IPC, the data flow can occur both ways. Nidra can obtain reports or results from the modules, and the modules can obtain samples in real-time and/or selective desired records, respectively. 
    \item[Filter modules based on package-name] Currently, all of the installed applications are listed when selecting a new module to add in Nidra. To improve the user experience, we can have that modules prerequisite is that the package name should start with \textit{com.cesar.X}---or something similar. With this, we can filter out unwanted applications, and display the module-applications that are eligible to the user.
\end{description}