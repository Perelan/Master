\chapter{Conclusion}

\section{Summary}
The motivation of this thesis was to extend the CESAR project by creating an application for the patients to record, share, and analyze breathing data. The data is supposed to aid researchers/doctors to analyze, diagnose, or examine the patient for sleep-related breathing disorders (e.g., Obstructive Sleep Apnea). However, the application can be applied to other fields of study (e.g., recording breathing during physical activity). Morever, the application should faciliate an interface for developers to create modules that extend the functionality or enrich the data of the application.

The application was designed by separating the tasks (i.e., recording, sharing, analyzing, modules, storage, and presentation) into concerns, whereas each concern proposed a structure that encompassed components with functionality and design choices. Based on the design, we implemented an application in Android, called Nidra. Nidra provides an interface to the user's to collect breathing data with the Flow sensor over an extended period, share the data across applications (e.g., sending the data to researchers/doctors over e-mail), and analyze the data within the application. Moreover, Nidra is capable of reconnecting with the sensor sources during disconnects, allowing for more richer and meaningful data on analysis. In addition, Nidra provides an interface for developers to create modules that allows for extended functionality and data enrichment. For example, a module can be using the records from the patient to apply machine-learning techniques in order to predict sleep apnea. 



\section{Contribution}
 As defined in our problem statement, we set three research goals with three system requirements. In the following sections, we reinstate and describe how this thesis contribute towards them.

\subsection{System Requirements}
The system requirements contributes towards fullfiling the goals of this thesis. In Chapter 6, we conducted experiements to evaluate the system requirements. Below, we describe the requirements and discuss the experiements has contributed towards fullfilling them. 

\begin{enumerate}
    \item \textit{The application should provide an interface for the patient to 1) record physiological signals (e.g., during sleep); 2) present the results; and 3) share the results.}
    
    This requirement is supported by experiments A, B, and C that proves that the application is capable of (1) recording breathing data over an extended period of time using the Flow sensor; also, reconnecting with the sensor source upon disconnects; (2) present the results in a time-series graph that allows analysis of the records; (3) sharing the records from various mobile devices using the a media-application (e.g., e-mail).

    \item \textit{The application should provide an interface for the developers to create modules to enrich the data from records or extend the functionality of the application.}
    
    This requirement is supported by the experiement D that proves that other developers can make 

    Experiment D was most considered with testing the feaseability of creating and adding a new module into Nidra. The participant in the experiement did not examine the code of the Nidra in order to create a module-application that use the data provided by Nidra. With simple instruction of how the data structure that are sent on launch to the module, the participant were able to create a simple module that extend the functionality of Nidra. This proves that future developers can create any form applications without having to understand how Nidra operates. However, while it were bit cumbersume to parse the data that was sent to the application, and having to start the mobile-application through Nidra, the functionality worked as intended. Thus, we provide an template to follow for future developers (in Appendix C). 
    
    \item \textit{The application should ensure a seamless and continuous data streams, uninterrupted from sensor disconnections and human disruptions.}
    
    In the analysis of experiement A, we observe that various mobile devices disconnected during the concert. Even though, there is gaps of missing data, the recording is able to reinitate with the sensor source during recording, without having to restart the recording session. As such, every samples count towards a complete recording, in which viable samples are accquired. This provies that the application is capable of providing an continous data streams with the sensor source, even when occurances of human disruptions or sensor disconnections happens. 
    
\end{enumerate}

Besides few subtle improvements that can be made to Nidra, the system requirements suffice towards the goal of making an application that can record, share, and analyze breathing data with the Flow sensor over an extended period. Also, the possbilies for future developers to create independent applications, witout having to operate with Nidra, in which provides extended functionality and enrich the collected data in Nidra. 

\subsection{Goals}

In the problem statement of this thesis, we defined three research goals. In this Section, we restate the goals in together with how our work solves the goals. 

\begin{description}
    \item[Goal 1] \textit{Integrate the support for Flow sensor with the extensible data streams dispatching tool.}

    In the implementation chapter of this thesis, we created a sensor wrapper for Flow sensor, which integrates with the data streams dispatching tool. The Flow sensor uses BlueTooth LE as a communication protocol; as such, we used the APIs provided by Android to connect with the sensor. We focused on extracting the flow (breathing) data and battery level, as well as the mac address and firmware level. The sensor collects data on a frequency of 10Hz; however, transmits a bundle of data points every 1.5Hz. The data points were packed into data packets and sent to the data streams dispatching tool, which is responsible for forwarding the data to subscribing applications, in our case, Nidra. As such, we evaluated the Flow sensor by conducting experiments, and the results show an accurate reading of the breath. 

    \item[Goal 2] \textit{Research and develop a user-friendly application which facilitates collection of breathing data with the use of the extensible data streams dispatching tool.}


    Through the work performed on this thesis, we designed and implemented an application which facilitates the collection of breathing data. The desired functionality of the application was separated into concerns. In the design of this thesis, we discuss various methods of implementation for each concern and selected method that fits our purpose.  In the implementation of this thesis, we realize the design choices by creating an Android application, called Nidra. Towards this goal of this thesis, the interface of the application was designed with cautious for the environment of use---it is most likely to be used during the night and early morning---and limiting the amount of actions a user can perform in order to create a simple and efficient application. Moreover, the application faciliate an application that can collect breathing data over an extended period, where the data collected from the sensor source (i.e., Flow sensor) were forwarded through the data streams dispatching tool. 


    \item[Goal 3] \textit{Create an extensible solution such that the developers can integrate stand-alone applications in our application.}

    In the design and implementation of this thesis, we facilitate for modules that future developers can create to integrate their functionality into Nidra without having to understand how Nidra operates. The motivation for this functionality is to allow future developers to enrich the data or extend the functionality by using the data provided by Nidra, and for patients to operate with one application for detection for sleep apnea. 
\end{description}


\section{Future Work}
Over the course of this thesis, we were able observe enhancements and improvements that can be made to the application. While the application fulfilles the goals defined in the problem statement, there are possibilities to make the experience of the application even richer. Below, we present the a short description of future work alongside with our proposition. 


\begin{description}
    \item[Improve the user-friendliness of Nidra:] In retrospect, we could see that the participants had trouble with finding the record button, as well as the indication of whether a recording had started. A proposition is to enlargen til record button, to make it more visible to the users. For the recording, perhaps have a more informative description of the various states (e.g., connecting, recording, or disconnected). 
    \item[Add support for other physiological data] The main focus in this thesis, was to gather breathing data during sleep. However, the possibility of extending Nidra to support other physiological data is possible (e.g., heart rate). The extensible approach to application, allows future developers to integrate the support for these data types, by simply extending the database and recording logic. 
    \item[Create an interface for sharing] A proposition in the design for sharing, was to create an interface solely for sharing data between users, without accessing other applications (e.g., mail). The idea was to create a server that maintains a user-base of patients and researchers/doctors, and a repository for shared records. By providing an interface for the patient to select the desired recipient, would allow for a simpler and convenient sharing for both the patient and the research/doctor. 
    \item[Bi-directional channel between Nidra and modules] As of now, the data is packed into a JSON string and bundled into an Intent on launch. As discussed in the design, this would mean that for the module to obtain the data the user has to launch the module through the application. For simplicity, this is sufficient; however, for future modules that depends on analyzing the data in real-time, that is not a suitable solution. Therefore, by establishing a bi-directional channel with Nidra and the modules is a solution to this problem. By utilizing binder's (with AIDL) for IPC, the data flow can occur both ways. Nidra can obtain reports or results from the modules, and the modules can obtain samples in real-time and/or selective desired records, respectively. 
    \item[Filter modules based on package-name] Currently, all of the installed applications are listed when selecting a new module to add in Nidra. To improve the user experience, we can have that modules prerequisite is that the package name should start with \textit{com.cesar.X}---or something similar. With this, we can filter out unwanted applications, and display the module-applications that are eligible to the user.
\end{description}